import{_ as N,k as m,b as z,d as B,l as _,o as u,c as v,a as p,m as c,p as f,t as b,F as D,f as T,j as h,i as w,A as j,J as M,K as R,L as S,M as L}from"./index-Dtm6_lkt.js";const F={class:"bilibili"},I={key:0,class:"video-list"},K={class:"desc"},O={class:"info"},q={class:"title"},J={class:"controls"},W={key:0,class:"progress-wrapper"},G={class:"progress-label"},H={__name:"bilibili",setup(Q){const i=m(""),y=m(!1),s=m([]),V=z(()=>s.value.length);function g(a){L.success({message:a})}function d(a){L.error({message:a})}async function x(a){try{await navigator.clipboard.writeText(a),g("已复制到剪贴板")}catch{d("复制失败，请手动复制")}}function A(){s.value=[]}async function U(){if(!i.value){d("请输入视频链接");return}y.value=!0,s.value=[];try{let a,e=null;if(i.value.includes("?p=")){const o=i.value.split("?p=");e=Number(o[1].split("&")[0]),a=o[0].split("/video/")[1]}else a=i.value.split("/video/")[1].split("/?spm_id_from")[0];const r=await M(a);if(!r.data||r.data.code!==0){d("解析失败");return}const l=r.data.data,n=l.pages||[];s.value=n.map((o,t)=>({avid:l.aid,cid:o.cid,page:t+1,title:`${l.title}_P${t+1}`,cover:l.pic,downloadUrl:null,fetchingUrl:!1,downloading:!1,progress:0})),e&&(s.value=s.value.filter(o=>o.page===e)),g("视频信息获取成功")}catch(a){console.error(a),d("获取视频信息失败")}finally{y.value=!1}}async function k(a){var r,l;const e=s.value[a];if(!(!e||e.downloadUrl||e.fetchingUrl)){e.fetchingUrl=!0;try{const n=await R(e.avid,e.cid),o=(l=(r=n==null?void 0:n.data)==null?void 0:r.data)==null?void 0:l.durl,t=Array.isArray(o)&&o.length?o[0].url:null;if(!t){d("后端未返回下载地址");return}e.downloadUrl=t,g(`P${e.page} 下载地址已获取`)}catch(n){console.error(n),d(`P${e.page} 获取地址失败`)}finally{e.fetchingUrl=!1}}}async function C(a){const e=s.value[a];if(!(!e||e.downloading)&&!(!e.downloadUrl&&(await k(a),!e.downloadUrl))){e.downloading=!0,e.progress=0;try{const r=await S.get(e.downloadUrl,{responseType:"blob",onDownloadProgress:o=>{o.total&&o.loaded&&(e.progress=Math.round(o.loaded/o.total*100))}}),l=window.URL.createObjectURL(r.data),n=document.createElement("a");n.download=e.title.replace(/[/\\:?<>|"]/g,"_")+".mp4",n.href=l,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l),e.progress=100,g(`P${e.page} 下载成功`)}catch(r){console.error(r),d(`P${e.page} 下载失败`)}finally{e.downloading=!1}}}async function E(){for(let a=0;a<s.value.length;a++)await C(a);g("全部下载任务完成")}return B(()=>{var a;document.body.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="b"&&(i.value="")}),window.innerWidth>768&&((a=document.querySelector("input"))==null||a.focus())}),(a,e)=>{const r=_("a-input"),l=_("a-button"),n=_("a-space"),o=_("a-progress");return u(),v("div",F,[p("div",null,[c(n,{direction:"horizontal",style:{width:"100%"}},{default:f(()=>[c(r,{style:{width:"600px"},value:i.value,"onUpdate:value":e[0]||(e[0]=t=>i.value=t),placeholder:"请输入视频链接...",onInput:A,onPressEnter:U,"allow-clear":""},null,8,["value"]),c(l,{type:"primary",loading:y.value,onClick:U},{default:f(()=>e[1]||(e[1]=[w(" 获取视频 ")])),_:1},8,["loading"]),c(l,{type:"default",disabled:s.value.length===0,onClick:E},{default:f(()=>e[2]||(e[2]=[w(" 下载全部 ")])),_:1},8,["disabled"])]),_:1})]),s.value.length?(u(),v("div",I,[p("p",K,"共 "+b(V.value)+" P",1),(u(!0),v(D,null,T(s.value,(t,P)=>(u(),v("div",{key:t.cid,class:"video-card"},[p("div",O,[p("p",q,b(t.title),1),p("div",J,[c(l,{size:"small",type:"default",onClick:$=>k(P),loading:t.fetchingUrl},{default:f(()=>e[3]||(e[3]=[w(" 获取地址 ")])),_:2},1032,["onClick","loading"]),c(l,{size:"small",type:"primary",loading:t.downloading,onClick:$=>C(P)},{default:f(()=>e[4]||(e[4]=[w(" 下载 ")])),_:2},1032,["loading","onClick"]),t.downloadUrl?(u(),j(l,{key:0,size:"small",type:"link",onClick:$=>x(t.downloadUrl)},{default:f(()=>e[5]||(e[5]=[w(" 复制地址 ")])),_:2},1032,["onClick"])):h("",!0)])]),t.progress>0||t.downloading?(u(),v("div",W,[c(o,{percent:t.progress,status:t.progress===100?"success":"active"},null,8,["percent","status"]),p("div",G,b(t.progress)+"%",1)])):h("",!0)]))),128))])):h("",!0)])}}},Y=N(H,[["__scopeId","data-v-a64b6b5a"]]);export{Y as default};
