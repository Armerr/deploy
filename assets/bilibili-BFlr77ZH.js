import{_ as N,k as m,b as z,d as B,l as y,o as u,c as v,a as p,m as c,p as f,t as b,F as D,f as T,j as h,i as _,A as j,J as M,K as S,L as F,M as L}from"./index-Bf0U3EsG.js";const I={class:"bilibili"},K={key:0,class:"video-list"},O={class:"desc"},q={class:"info"},J={class:"title"},W={class:"controls"},G={key:0,class:"progress-wrapper"},H={class:"progress-label"},Q={__name:"bilibili",setup(R){const i=m(""),w=m(!1),s=m([]),V=z(()=>s.value.length);function g(t){L.success({message:t})}function d(t){L.error({message:t})}async function x(t){try{await navigator.clipboard.writeText(t),g("已复制到剪贴板")}catch{d("复制失败，请手动复制")}}function A(){s.value=[]}async function U(){if(!i.value){d("请输入视频链接");return}w.value=!0,s.value=[];try{let t,e=null;if(i.value.includes("?p=")){const o=i.value.split("?p=");e=Number(o[1].split("&")[0]),t=o[0].split("/video/")[1]}else t=i.value.split("/video/")[1].split("/?spm_id_from")[0];M(t).then(o=>{if(!o.data||o.data.code!==0){d("解析失败");return}const l=o.data.data,r=l.pages||[];s.value=r.map((n,a)=>({avid:l.aid,cid:n.cid,page:a+1,title:`${l.title}_P${a+1}`,cover:l.pic,downloadUrl:null,fetchingUrl:!1,downloading:!1,progress:0})),e&&(s.value=s.value.filter(n=>n.page===e)),g("视频信息获取成功")})}catch(t){console.error(t),d("获取视频信息失败")}finally{w.value=!1}}async function k(t){const e=s.value[t];if(!(!e||e.downloadUrl||e.fetchingUrl)){e.fetchingUrl=!0;try{S(e.avid,e.cid).then(o=>{var n,a;const l=(a=(n=o==null?void 0:o.data)==null?void 0:n.data)==null?void 0:a.durl,r=Array.isArray(l)&&l.length?l[0].url:null;if(!r){d("后端未返回下载地址");return}e.downloadUrl=r,g(`P${e.page} 下载地址已获取`)})}catch(o){console.error(o),d(`P${e.page} 获取地址失败`)}finally{e.fetchingUrl=!1}}}async function C(t){const e=s.value[t];if(!(!e||e.downloading)&&!(!e.downloadUrl&&(await k(t),!e.downloadUrl))){e.downloading=!0,e.progress=0;try{const o=await F.get(e.downloadUrl,{responseType:"blob",onDownloadProgress:n=>{n.total&&n.loaded&&(e.progress=Math.round(n.loaded/n.total*100))}}),l=window.URL.createObjectURL(o.data),r=document.createElement("a");r.download=e.title.replace(/[/\\:?<>|"]/g,"_")+".mp4",r.href=l,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(l),e.progress=100,g(`P${e.page} 下载成功`)}catch(o){console.error(o),d(`P${e.page} 下载失败`)}finally{e.downloading=!1}}}async function E(){for(let t=0;t<s.value.length;t++)await C(t);g("全部下载任务完成")}return B(()=>{var t;document.body.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="b"&&(i.value="")}),window.innerWidth>768&&((t=document.querySelector("input"))==null||t.focus())}),(t,e)=>{const o=y("a-input"),l=y("a-button"),r=y("a-space"),n=y("a-progress");return u(),v("div",I,[p("div",null,[c(r,{direction:"horizontal",style:{width:"100%"}},{default:f(()=>[c(o,{style:{width:"600px"},value:i.value,"onUpdate:value":e[0]||(e[0]=a=>i.value=a),placeholder:"请输入视频链接...",onInput:A,onPressEnter:U,"allow-clear":""},null,8,["value"]),c(l,{type:"primary",loading:w.value,onClick:U},{default:f(()=>e[1]||(e[1]=[_(" 获取视频 ")])),_:1},8,["loading"]),c(l,{type:"default",disabled:s.value.length===0,onClick:E},{default:f(()=>e[2]||(e[2]=[_(" 下载全部 ")])),_:1},8,["disabled"])]),_:1})]),s.value.length?(u(),v("div",K,[p("p",O,"共 "+b(V.value)+" P",1),(u(!0),v(D,null,T(s.value,(a,P)=>(u(),v("div",{key:a.cid,class:"video-card"},[p("div",q,[p("p",J,b(a.title),1),p("div",W,[c(l,{size:"small",type:"default",onClick:$=>k(P),loading:a.fetchingUrl},{default:f(()=>e[3]||(e[3]=[_(" 获取地址 ")])),_:2},1032,["onClick","loading"]),c(l,{size:"small",type:"primary",loading:a.downloading,onClick:$=>C(P)},{default:f(()=>e[4]||(e[4]=[_(" 下载 ")])),_:2},1032,["loading","onClick"]),a.downloadUrl?(u(),j(l,{key:0,size:"small",type:"link",onClick:$=>x(a.downloadUrl)},{default:f(()=>e[5]||(e[5]=[_(" 复制地址 ")])),_:2},1032,["onClick"])):h("",!0)])]),a.progress>0||a.downloading?(u(),v("div",G,[c(n,{percent:a.progress,status:a.progress===100?"success":"active"},null,8,["percent","status"]),p("div",H,b(a.progress)+"%",1)])):h("",!0)]))),128))])):h("",!0)])}}},Y=N(Q,[["__scopeId","data-v-f3101d31"]]);export{Y as default};
