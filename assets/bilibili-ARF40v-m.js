import{_ as N,r as m,b as z,d as B,l as w,o as u,c as v,a as p,m as c,p as f,t as b,F as D,f as T,j as h,i as _,A as j,J as M,K as R,L as S,M as L}from"./index-BwrNL2J5.js";const F={class:"bilibili"},I={key:0,class:"video-list"},K={class:"desc"},O={class:"info"},q={class:"title"},J={class:"controls"},W={key:0,class:"progress-wrapper"},G={class:"progress-label"},H={__name:"bilibili",setup(Q){const i=m(""),y=m(!1),r=m([]),V=z(()=>r.value.length);function g(t){L.success({message:t})}function d(t){L.error({message:t})}async function x(t){try{await navigator.clipboard.writeText(t),g("已复制到剪贴板")}catch{d("复制失败，请手动复制")}}function A(){r.value=[]}async function U(){if(!i.value){d("请输入视频链接");return}y.value=!0,r.value=[];try{let t,e=null;if(i.value.includes("?p=")){const l=i.value.split("?p=");e=Number(l[1].split("&")[0]),t=l[0].split("/video/")[1]}else t=i.value.split("/video/")[1].split("/?spm_id_from")[0];M(t).then(l=>{if(!l.data||l.data.code!==0){d("解析失败");return}const o=l.data.data,n=o.pages||[];r.value=n.map((s,a)=>({avid:o.aid,cid:s.cid,page:a+1,title:`${o.title}_P${a+1}`,cover:o.pic,downloadUrl:null,fetchingUrl:!1,downloading:!1,progress:0})),e&&(r.value=r.value.filter(s=>s.page===e)),g("视频信息获取成功")})}catch(t){console.error(t),d("获取视频信息失败")}finally{y.value=!1}}async function k(t){var l,o;const e=r.value[t];if(!(!e||e.downloadUrl||e.fetchingUrl)){e.fetchingUrl=!0;try{const n=await R(e.avid,e.cid),s=(o=(l=n==null?void 0:n.data)==null?void 0:l.data)==null?void 0:o.durl,a=Array.isArray(s)&&s.length?s[0].url:null;if(!a){d("后端未返回下载地址");return}e.downloadUrl=a,g(`P${e.page} 下载地址已获取`)}catch(n){console.error(n),d(`P${e.page} 获取地址失败`)}finally{e.fetchingUrl=!1}}}async function C(t){const e=r.value[t];if(!(!e||e.downloading)&&!(!e.downloadUrl&&(await k(t),!e.downloadUrl))){e.downloading=!0,e.progress=0;try{const l=await S.get(e.downloadUrl,{responseType:"blob",onDownloadProgress:s=>{s.total&&s.loaded&&(e.progress=Math.round(s.loaded/s.total*100))}}),o=window.URL.createObjectURL(l.data),n=document.createElement("a");n.download=e.title.replace(/[/\\:?<>|"]/g,"_")+".mp4",n.href=o,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(o),e.progress=100,g(`P${e.page} 下载成功`)}catch(l){console.error(l),d(`P${e.page} 下载失败`)}finally{e.downloading=!1}}}async function E(){for(let t=0;t<r.value.length;t++)await C(t);g("全部下载任务完成")}return B(()=>{var t;document.body.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="b"&&(i.value="")}),window.innerWidth>768&&((t=document.querySelector("input"))==null||t.focus())}),(t,e)=>{const l=w("a-input"),o=w("a-button"),n=w("a-space"),s=w("a-progress");return u(),v("div",F,[p("div",null,[c(n,{direction:"horizontal",style:{width:"100%"}},{default:f(()=>[c(l,{style:{width:"600px"},value:i.value,"onUpdate:value":e[0]||(e[0]=a=>i.value=a),placeholder:"请输入视频链接...",onInput:A,onPressEnter:U,"allow-clear":""},null,8,["value"]),c(o,{type:"primary",loading:y.value,onClick:U},{default:f(()=>e[1]||(e[1]=[_(" 获取视频 ")])),_:1},8,["loading"]),c(o,{type:"default",disabled:r.value.length===0,onClick:E},{default:f(()=>e[2]||(e[2]=[_(" 下载全部 ")])),_:1},8,["disabled"])]),_:1})]),r.value.length?(u(),v("div",I,[p("p",K,"共 "+b(V.value)+" P",1),(u(!0),v(D,null,T(r.value,(a,P)=>(u(),v("div",{key:a.cid,class:"video-card"},[p("div",O,[p("p",q,b(a.title),1),p("div",J,[c(o,{size:"small",type:"default",onClick:$=>k(P),loading:a.fetchingUrl},{default:f(()=>e[3]||(e[3]=[_(" 获取地址 ")])),_:2},1032,["onClick","loading"]),c(o,{size:"small",type:"primary",loading:a.downloading,onClick:$=>C(P)},{default:f(()=>e[4]||(e[4]=[_(" 下载 ")])),_:2},1032,["loading","onClick"]),a.downloadUrl?(u(),j(o,{key:0,size:"small",type:"link",onClick:$=>x(a.downloadUrl)},{default:f(()=>e[5]||(e[5]=[_(" 复制地址 ")])),_:2},1032,["onClick"])):h("",!0)])]),a.progress>0||a.downloading?(u(),v("div",W,[c(s,{percent:a.progress,status:a.progress===100?"success":"active"},null,8,["percent","status"]),p("div",G,b(a.progress)+"%",1)])):h("",!0)]))),128))])):h("",!0)])}}},Y=N(H,[["__scopeId","data-v-42a88e1f"]]);export{Y as default};
