import{_ as N,k as m,b as z,d as B,l as _,o as u,c as v,a as p,m as d,p as f,t as b,F as D,f as T,j as h,i as w,A as j,J as M,K as R,L as S,M as L}from"./index-Br_OBZEi.js";const F={class:"bilibili"},I={key:0,class:"video-list"},K={class:"desc"},O={class:"info"},q={class:"title"},J={class:"controls"},W={key:0,class:"progress-wrapper"},G={class:"progress-label"},H={__name:"bilibili",setup(Q){const i=m(""),y=m(!1),s=m([]),V=z(()=>s.value.length);function g(o){L.success({message:o})}function c(o){L.error({message:o})}async function x(o){try{await navigator.clipboard.writeText(o),g("已复制到剪贴板")}catch{c("复制失败，请手动复制")}}function A(){s.value=[]}async function U(){if(!i.value){c("请输入视频链接");return}y.value=!0,s.value=[];try{let o,e=null;if(i.value.includes("?p=")){const t=i.value.split("?p=");e=Number(t[1].split("&")[0]),o=t[0].split("/video/")[1]}else o=i.value.split("/video/")[1].split("/?spm_id_from")[0];const l=await M(o),a=l.pages||[];s.value=a.map((t,r)=>({avid:l.aid,cid:t.cid,page:r+1,title:`${l.title}_P${r+1}`,cover:l.pic,downloadUrl:null,fetchingUrl:!1,downloading:!1,progress:0})),e&&(s.value=s.value.filter(t=>t.page===e)),g("视频信息获取成功")}catch(o){console.error(o),c("获取视频信息失败")}finally{y.value=!1}}async function k(o){const e=s.value[o];if(!(!e||e.downloadUrl||e.fetchingUrl)){e.fetchingUrl=!0;try{const l=await R(e.avid,e.cid),a=l==null?void 0:l.durl,t=Array.isArray(a)&&a.length?a[0].url:null;if(!t){c("后端未返回下载地址");return}e.downloadUrl=t,g(`P${e.page} 下载地址已获取`)}catch(l){console.error(l),c(`P${e.page} 获取地址失败`)}finally{e.fetchingUrl=!1}}}async function C(o){const e=s.value[o];if(!(!e||e.downloading)&&!(!e.downloadUrl&&(await k(o),!e.downloadUrl))){e.downloading=!0,e.progress=0;try{const l=await S.get(e.downloadUrl,{responseType:"blob",onDownloadProgress:r=>{r.total&&r.loaded&&(e.progress=Math.round(r.loaded/r.total*100))}}),a=window.URL.createObjectURL(l.data),t=document.createElement("a");t.download=e.title.replace(/[/\\:?<>|"]/g,"_")+".mp4",t.href=a,document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(a),e.progress=100,g(`P${e.page} 下载成功`)}catch(l){console.error(l),c(`P${e.page} 下载失败`)}finally{e.downloading=!1}}}async function E(){for(let o=0;o<s.value.length;o++)await C(o);g("全部下载任务完成")}return B(()=>{var o;document.body.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="b"&&(i.value="")}),window.innerWidth>768&&((o=document.querySelector("input"))==null||o.focus())}),(o,e)=>{const l=_("a-input"),a=_("a-button"),t=_("a-space"),r=_("a-progress");return u(),v("div",F,[p("div",null,[d(t,{direction:"horizontal",style:{width:"100%"}},{default:f(()=>[d(l,{style:{width:"600px"},value:i.value,"onUpdate:value":e[0]||(e[0]=n=>i.value=n),placeholder:"请输入视频链接...",onInput:A,onPressEnter:U,"allow-clear":""},null,8,["value"]),d(a,{type:"primary",loading:y.value,onClick:U},{default:f(()=>e[1]||(e[1]=[w(" 获取视频 ")])),_:1},8,["loading"]),d(a,{type:"default",disabled:s.value.length===0,onClick:E},{default:f(()=>e[2]||(e[2]=[w(" 下载全部 ")])),_:1},8,["disabled"])]),_:1})]),s.value.length?(u(),v("div",I,[p("p",K,"共 "+b(V.value)+" P",1),(u(!0),v(D,null,T(s.value,(n,P)=>(u(),v("div",{key:n.cid,class:"video-card"},[p("div",O,[p("p",q,b(n.title),1),p("div",J,[d(a,{size:"small",type:"default",onClick:$=>k(P),loading:n.fetchingUrl},{default:f(()=>e[3]||(e[3]=[w(" 获取地址 ")])),_:2},1032,["onClick","loading"]),d(a,{size:"small",type:"primary",loading:n.downloading,onClick:$=>C(P)},{default:f(()=>e[4]||(e[4]=[w(" 下载 ")])),_:2},1032,["loading","onClick"]),n.downloadUrl?(u(),j(a,{key:0,size:"small",type:"link",onClick:$=>x(n.downloadUrl)},{default:f(()=>e[5]||(e[5]=[w(" 复制地址 ")])),_:2},1032,["onClick"])):h("",!0)])]),n.progress>0||n.downloading?(u(),v("div",W,[d(r,{percent:n.progress,status:n.progress===100?"success":"active"},null,8,["percent","status"]),p("div",G,b(n.progress)+"%",1)])):h("",!0)]))),128))])):h("",!0)])}}},Y=N(H,[["__scopeId","data-v-3510868b"]]);export{Y as default};
